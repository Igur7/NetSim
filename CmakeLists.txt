cmake_minimum_required(VERSION 3.17)

project(Netsim)

set(CMAKE_CXX_STANDARD 17)

# Ścieżka do nagłówków
include_directories(include)

set(CORE_SOURCES
        src/simulation.cpp
        src/factory.cpp
        src/helpers.cpp
        src/nodes.cpp
        src/package.cpp
        src/reports.cpp
        src/storage_types.cpp
)

# 2. GŁÓWNA APLIKACJA
add_executable(main main.cpp ${CORE_SOURCES})

add_subdirectory(googletest-1.16.0 googletest-master)



set(TEST_SOURCES
        test/test_storage.cpp
        test/test_factory.cpp  
        )


add_executable(Netsim_test 
        test/main_gtest.cpp 
        ${TEST_SOURCES} 
        ${CORE_SOURCES}
)

target_include_directories(Netsim_test PUBLIC
        googletest-1.16.0/googlemock/include
        googletest-1.16.0/googletest/include
)

target_link_libraries(Netsim_test gtest gmock)

configure_file(
    ${CMAKE_SOURCE_DIR}/data/fa.txt
    ${CMAKE_BINARY_DIR}/fa.txt
    COPYONLY
)

find_program(DOT_EXECUTABLE dot)

if (DOT_EXECUTABLE)
    message(STATUS "Graphviz found: ${DOT_EXECUTABLE}")
else()
    message(WARNING "Graphviz NOT found – PNG will not be generated")
endif()

enable_testing()
add_test(NAME AllTests COMMAND Netsim_test)